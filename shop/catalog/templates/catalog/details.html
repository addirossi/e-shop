{% extends "base.html" %}

{% load static %}

{% block title %}
  {{ product.name }}
{% endblock %}
{% block content %}
  <div class="product-detail">
    <div class="col-sm-4">
      <img src="{% if product.image %}{{ MEDIA_URL }}{{ product.image}}{% else %}{% static "img/no-image.jpg"%}{% endif %}" class="img-responsive">
    </div>
    <div class="col-sm-8">
      <h1>{{ product.name }}</h1>
      <h2><a href="{{ product.category.get_absolute_url }}">{{ product.category }}</a></h2>
      <p class="price">
        {{ product.price }} som.
      </p>
      <span>
        {{ product.description | linebreaks}}
      </span>
      <p class="price">{{ product.price }} som.</p>
      <form action="{% url "cart:cart-add" product.id %}" method="post" id="cart-add-form" data-redirect="{% url 'cart:cart-detail' %}">
          {{ cart_product_form }}
          {% csrf_token %}
          <input type="submit" value="Add to cart">
      </form>
    </div>
  </div>

{% endblock %}
{% block js %}
    <script>
        (function ($) {
            var $form = $('#cart-add-form');
            $form.ajaxForm(function (res) {
                if(res.status === 'ok' && res.redirect) {
                    window.location = $form.data('redirect');
                } else {
                    alert('Error', res.status);
                }
                console.log(res);
            });
        })(jQuery);
    </script>
{% endblock js %}